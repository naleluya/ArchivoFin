<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Prestamo_model extends CI_Model{    public function __construct()    {        parent::__construct();        $this->load->database();    }    function list_gestion()    {        $query=$this->db->get('gestion');        return $query->result();    }    function list_adminHab()    {        $query = $this->db->query("SELECT *                        FROM usuario INNER JOIN habilitar ON (usuario.usu_id = habilitar.usu_id)                         INNER JOIN roles ON (habilitar.rol_id = roles.rol_id)                        WHERE roles.rol_id=1 and habilitar.hab_estado='t'                        ORDER by usuario.usu_paterno;         ");        return $query->result();    }    function list_prestamos()    {        $this->db->order_by("pre_fecha_prestamo", "desc");        $this->db->where('pre_estado',true );        $query=$this->db->get('prestamo');        return $query->result();    }    public function search_queries($bus_name_file,$bus_nro_file,$bus_year_file)    {        $this->db->from($bus_name_file);        $this->db->where($bus_name_file.'_nro', $bus_nro_file);        $this->db->where($bus_name_file.'_gestion', $bus_year_file);        $query = $this->db->get();        return $query->row();    }    public function savePrestamo($data)    {        $this->db->insert('prestamo', $data);    }    public function saveDocumento($data)    {        $this->db->insert('documentos', $data);    }    function list_doc($pre_id)    {        $this->db->order_by("doc_gestion", "desc");        $this->db->where("pre_id",$pre_id);        $query=$this->db->get('documentos');        return $query->result();    }    function list_archivos_decrip($doc_name,$doc_nro,$doc_gestion)    {        $this->db->select($doc_name."_descripcion");        $this->db->where($doc_name."_nro",$doc_nro);        $this->db->where($doc_name."_gestion",$doc_gestion);        $this->db->from($doc_name);        $query=$this->db->get();        return $query->row();    }    function list_archivos_fojas($doc_name,$doc_nro,$doc_gestion)    {        $this->db->select($doc_name."_nro_fojas");        $this->db->where($doc_name."_nro",$doc_nro);        $this->db->where($doc_name."_gestion",$doc_gestion);        $this->db->from($doc_name);        $query=$this->db->get();        return $query->row();    }    function row_adminHab($usu_id)    {        $query = $this->db->query("SELECT *                        FROM usuario INNER JOIN habilitar ON (usuario.usu_id = habilitar.usu_id)                         INNER JOIN roles ON (habilitar.rol_id = roles.rol_id)                        WHERE roles.rol_id=1 and habilitar.hab_estado='t' and usuario.usu_id=$usu_id                        ORDER by usuario.usu_paterno;         ");        return $query->row();    }    function ver_Archivo($pre_id)    {        $this->db->select("*");        $this->db->from("documentos");        $this->db->where("pre_id",$pre_id);        $query=$this->db->get();        return $query->result();    }    function ver_Detalle_Archivo($doc_name, $doc_nro, $doc_gestion)    {        $this->db->select($doc_name.'_monto AS monto, '.$doc_name.'_beneficiario AS beneficiario,'.$doc_name.'_descripcion AS descripcion');        $this->db->from($doc_name);        $this->db->where($doc_name."_nro", $doc_nro);        $this->db->where($doc_name."_gestion", $doc_gestion);        $query=$this->db->get();        return $query->row();    }    public function finalizarPrestamo($id,$data)    {        $this->db->where('pre_id', $id);        $this->db->update('prestamo', $data);        if ($this->db->affected_rows() > 0)            return true;        else            return false;    }    function cant_Prestamos($fechaActual)    {        $query = $this->db->query("SELECT COUNT(pre_fecha_devolucion) as pre_cantidad                                    FROM prestamo                                    WHERE pre_fecha_devolucion<'$fechaActual' and pre_estado = true         ");        return $query->row();    }    function list_prestamos_mora($fechaActual)    {        $query = $this->db->query("SELECT pre_solicitante, pre_cite_af, pre_fecha_prestamo, pre_fecha_devolucion, pre_dependencia, ('$fechaActual' - pre_fecha_devolucion) as pre_diferencia                                    FROM prestamo                                    WHERE pre_fecha_devolucion<'$fechaActual'and pre_estado = true        ");        return $query->result();    }    function lista_prestamos_moras($fechaActual)    {        $query = $this->db->query("SELECT pre_solicitante, pre_cite_af, pre_fecha_prestamo, pre_fecha_devolucion, pre_dependencia, ('$fechaActual' - pre_fecha_devolucion) as pre_diferencia                                    FROM prestamo                                    WHERE pre_fecha_devolucion<'$fechaActual'and pre_estado = true        ");        return $query->result();    }    function list_prestamos_historial()    {        $this->db->order_by("pre_fecha_prestamo", "desc");        $query=$this->db->get('prestamo');        return $query->result();    }    /* Desarrollado por:        Lic. Mark Erik Copa        Ing. Nelson Erwin Aleluya        G.A.M.E.A.        2018 */}