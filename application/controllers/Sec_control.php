<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Sec_control extends CI_Controller{    public function __construct()    {        parent::__construct();        $this->load->model('Prestamo_model');        $this->load->model('Dtm_model');        $this->load->model('Ci_modelo');        $this->load->model('Cd_model');        $this->load->model('Cdaf_model');        $this->load->model('Pdp_model');        $this->load->model('Pmruc_model');        $this->load->model('Login_model');        $this->load->model('User_model');        $this->load->helper(array('html', 'url', 'form'));        $this->load->library('session');        $this->load->library('upload');    }    ////////DTM///////////////    public function index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('DTM/dtm_sec');            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_DTM()    {        $fetch_data = $this->Dtm_model->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Dtm_model->list_dtmComplement($row->dtm_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>DTM</b>: <span style="background-color: #FFFF66">' . $row->dtm_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->dtm_gestion;                $pg_date = $rowComplement->dtm_fecha_ingreso;                $date_obj = date_create_from_format('Y-m-d', $pg_date);                $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->dtm_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->dtm_nro_fojas . '<br><span  data-role="hint"                data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->dtm_monto, 2, ',', '.');            $subarray[] = '<span  data-role="hint" data-hint-text="Beneficiario" data-hint-position="right"><span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' .                $row->dtm_beneficiario . '</span></span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="right"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->dtm_nro_cheque.                '<br><span ><b>Nro. Contrato:</b> ' . $rowComplement->dtm_nro_con .'</span>';            $subarray[] = '<span><b>Por:</b> ' . $row->dtm_descripcion .'</span>';            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->dtm_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->dtm_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->dtm_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->dtm_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->dtm_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->dtm_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->dtm_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->dtm_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->dtm_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->dtm_obj_gasto;            if ($row->dtm_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->dtm_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a>';            }            else {                $subarray[] = '<span class="mif-file-empty mif-5x"></span>';            }            $subarray[] = '<span style="display: none;">'.$row->dtm_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Dtm_model->get_all_data(),            "recordsFiltered" => $this->Dtm_model->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_dtm($dtm_id)    {        $data = $this->Dtm_model->getDTM($dtm_id);        echo json_encode($data);    }    ////////CI///////////////    public function ci_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('CI/ci_sec');            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_CI()    {        $fetch_data = $this->Ci_modelo->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Ci_modelo->list_ciComplement($row->ci_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>CI</b>: <span style="background-color: #FFFF66">' . $row->ci_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->ci_gestion;            $pg_date = $rowComplement->ci_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->ci_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->ci_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->ci_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->ci_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->ci_nro_cheque .                '<br><b>Nro. Contrato:</b> ' . $rowComplement->ci_nro_con . '</span>';            $subarray[] = '<b>Por:</b> ' . $row->ci_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->ci_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->ci_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->ci_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b></span>' . $row->ci_cuce . '<br><b>Obj. de Gasto: </b>' . $rowComplement->ci_obj_gasto;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->ci_sisin . '</span><br><b>Part. Pptria.: </b> ' . $rowComplement->ci_partida_pre;            if ($row->ci_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->ci_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a>';            }            else {                $subarray[] = '<span class="mif-file-empty mif-5x"></span>';            }            $subarray[] = '<span style="display: none;">'.$row->ci_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Ci_modelo->get_all_data(),            "recordsFiltered" => $this->Ci_modelo->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_ci($ci_id)    {        $data = $this->Ci_modelo->getCI($ci_id);        echo json_encode($data);    }    ////////CD///////////////    public function cd_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('CD/cd_sec');            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_CD()    {        $fetch_data = $this->Cd_model->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Cd_model->list_cdComplement($row->cd_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>CD</b>: <span style="background-color: #FFFF66">' . $row->cd_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->cd_gestion;            $pg_date = $rowComplement->cd_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->cd_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->cd_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->cd_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"><span  data-role="hint" data-hint-text="Beneficiario" data-hint-position="right"></span></span> ' . $row->cd_beneficiario . '</span></span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->cd_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->cd_nro_con;            $subarray[] = '<b>Por:</b> ' . $row->cd_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->cd_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->cd_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->cd_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->cd_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->cd_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->cd_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->cd_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->cd_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->cd_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->cd_obj_gasto;            if ($row->cd_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->cd_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a>';            }            else {                $subarray[] = '<span class="mif-file-empty mif-5x"></span>';            }            $subarray[] = '<span style="display: none;">'.$row->cd_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Cd_model->get_all_data(),            "recordsFiltered" => $this->Cd_model->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_cd($cd_id)    {        $data = $this->Cd_model->getCD($cd_id);        echo json_encode($data);    }    ////////CDAF///////////////    public function cdaf_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('CDAF/cdaf_sec');            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_CDAF()    {        $fetch_data = $this->Cdaf_model->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Cdaf_model->list_cdafComplement($row->cdaf_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>CDAF</b>: <span style="background-color: #FFFF66">' . $row->cdaf_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->cdaf_gestion;                $pg_date = $rowComplement->cdaf_fecha_ingreso;                $date_obj = date_create_from_format('Y-m-d', $pg_date);                $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->cdaf_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->cdaf_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->cdaf_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->cdaf_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->cdaf_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->cdaf_nro_con;            $subarray[] = '<b>Por:</b> ' . $row->cdaf_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->cdaf_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->cdaf_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->cdaf_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->cdaf_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->cdaf_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->cdaf_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->cdaf_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->cdaf_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->cdaf_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->cdaf_obj_gasto;            if ($row->cdaf_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->cdaf_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a>';            }            else {                $subarray[] = '<span class="mif-file-empty mif-5x"></span>';            }            $subarray[] = '<span style="display: none;">'.$row->cdaf_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Cdaf_model->get_all_data(),            "recordsFiltered" => $this->Cdaf_model->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_cdaf($cdaf_id)    {        $data = $this->Cdaf_model->getCDAF($cdaf_id);        echo json_encode($data);    }    ////////PDP///////////////    public function pdp_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('PDP/pdp_sec');            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_PDP()    {        $fetch_data = $this->Pdp_model->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Pdp_model->list_pdpComplement($row->pdp_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>PDP</b>: <span style="background-color: #FFFF66">' . $row->pdp_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->pdp_gestion;            $pg_date = $rowComplement->pdp_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->pdp_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->pdp_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->pdp_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->pdp_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->pdp_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->pdp_nro_con;            $subarray[] = '<br><b>Por:</b> ' . $row->pdp_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->pdp_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->pdp_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->pdp_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->pdp_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->pdp_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->pdp_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->pdp_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->pdp_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->pdp_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->pdp_obj_gasto;            if ($row->pdp_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->pdp_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a>';            }            else {                $subarray[] = '<span class="mif-file-empty mif-5x"></span>';            }            $subarray[] = '<span style="display: none;">'.$row->pdp_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Pdp_model->get_all_data(),            "recordsFiltered" => $this->Pdp_model->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_pdp($pdp_id)    {        $data = $this->Pdp_model->getPDP($pdp_id);        echo json_encode($data);    }    ////////PMRUC///////////////    public function pmruc_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('PMRUC/pmruc_sec');            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_PMRUC()    {        $fetch_data = $this->Pmruc_model->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Pmruc_model->list_pmrucComplement($row->pmruc_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>PMRUC</b>: <span style="background-color: #FFFF66">' . $row->pmruc_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->pmruc_gestion;            $pg_date = $rowComplement->pmruc_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->pmruc_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->pmruc_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->pmruc_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->pmruc_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->pmruc_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->pmruc_nro_con;            $subarray[] = '<br><b>Por:</b> ' . $row->pmruc_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->pmruc_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->pmruc_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->pmruc_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->pmruc_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->pmruc_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->pmruc_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->pmruc_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->pmruc_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->pmruc_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->pmruc_obj_gasto;            if ($row->pmruc_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->pmruc_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a>';            }            else {                $subarray[] = '<span class="mif-file-empty mif-5x"></span>';            }            $subarray[] = '<span style="display: none;">'.$row->pmruc_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Pmruc_model->get_all_data(),            "recordsFiltered" => $this->Pmruc_model->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_pmruc($pmruc_id)    {        $data = $this->Pmruc_model->getPMRUC($pmruc_id);        echo json_encode($data);    }    ////////PRESTAMO///////////////    public function prestamo_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $data['gestion']=$this->Prestamo_model->list_gestion();                $data['admin']=$this->Prestamo_model->list_adminHab();                $data['prestamos']=$this->Prestamo_model->list_prestamos();                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('head', $data_session);                $this->load->view('menu_sec',$pre);                $this->load->view('PRESTAMO/prestamo_sec',$data);            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    public function show_queries()    {        $bus_name_file = strip_tags(trim($this->input->post('bus_name_file')));        $bus_nro_file = strip_tags(trim($this->input->post('bus_nro_file')));        $bus_year_file = strip_tags(trim($this->input->post('bus_year_file')));        $q=$this->Prestamo_model->search_queries($bus_name_file,$bus_nro_file,$bus_year_file);        echo json_encode($q);    }    public function save_prestamo()    {        $data_session = $this->session->all_userdata();        $doc_name = $this->input->post('doc_name');        $doc_nro = $this->input->post('doc_nro');        $doc_gestion = $this->input->post('doc_gestion');        if ($doc_name!=NULL and $doc_nro!=NULL and $doc_gestion!=NULL)        {            $pre_solicitante = strip_tags(trim(strtoupper($this->input->post('pre_solicitante'))));            $pre_cite_solicitud = strip_tags(trim(strtoupper($this->input->post('pre_cite_solicitud'))));            $pre_dependencia = strip_tags(trim(strtoupper($this->input->post('pre_dependencia'))));            $pre_fecha_prestamo = strip_tags(trim($this->input->post('pre_fecha_prestamo')));            $pre_fecha_devolucion = strip_tags(trim($this->input->post('pre_fecha_devolucion')));            $pre_cite_af = strip_tags(trim(strtoupper($this->input->post('pre_cite_af'))));            $pre_autorizado = strip_tags(trim(strtoupper($this->input->post('pre_autorizado'))));            $pre_observaciones = strip_tags(trim(strtoupper($this->input->post('pre_observaciones'))));            $data_prestamo = array(                'pre_solicitante' => $pre_solicitante,                'pre_cite_solicitud' => $pre_cite_solicitud,                'pre_dependencia' => $pre_dependencia,                'pre_fecha_prestamo' => $pre_fecha_prestamo,                'pre_fecha_devolucion' => $pre_fecha_devolucion,                'pre_estado'=>true,                'pre_cite_af' => $pre_cite_af,                'usu_id_rol'=>$data_session['usu_id'],                'pre_autorizado' => $pre_autorizado,                'pre_observaciones' => $pre_observaciones,                'pre_fecha_real_dev'=>null            );            $this->Prestamo_model->savePrestamo($data_prestamo);            $pre_id=$this->db->insert_id();            for ($i=0;$i<count($doc_name);$i++)            {  $data_doc = array(                'doc_name' => $doc_name[$i],                'doc_nro' => $doc_nro[$i],                'doc_gestion' => $doc_gestion[$i],                'pre_id' => $pre_id                );                $this->Prestamo_model->saveDocumento($data_doc);            }            /////REPORT PDF//////            $this->load->library('ciqrcode');            $this->load->library('Pdf');            $pdf = new Pdf('P', 'mm', 'LETTER', true, 'UTF-8', false);            // set document information            $pdf->SetCreator(PDF_CREATOR);            $pdf->SetAuthor('UNIDAD DE SISTEMAS');            $pdf->SetTitle('REPORTE DE PRESTAMO');            $pdf->SetKeywords('reporte PDF, Reporte de prestamo');            // set header and footer fonts            $pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));            $pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));            // set margins            $pdf->SetMargins(PDF_MARGIN_LEFT,40, PDF_MARGIN_RIGHT,60);            $pdf->SetPrintHeader(false);            $pdf->SetFooterMargin(20);            // set font            $pdf->SetFont('helvetica', '', 11);            // set auto page breaks            $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);            // set image scale factor            $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);            $pdf->AddPage();            date_default_timezone_set('America/La_Paz');            $time = time();            $txt=$data_session['usu_nombres'].'|'.$data_session['usu_paterno'].'|'.$data_session['usu_materno'].' '.$data_session['usu_ci'].'|'                .$data_session['rol_nombre'].'|'.$pre_solicitante.'|'.$pre_dependencia;            $txt.='|'.date("d-m-Y (H:i:s)", $time);            $params['data'] = $txt;            $params['level'] = 'H';            $params['size'] = 10;            $params['savename'] = FCPATH.'assets/qr/'.$pre_id.'.png';            $this->ciqrcode->generate($params);            $html_head='                <table>                  <tr>                     <td rowspan="4" style="width: 40%; font-size:8px;">                        <b>GOBIERNO AUTONOMO MUNICIPAL DE EL ALTO<br></b>                        <b>  SECRETARIA MUNICIPAL DE ADMINISTRACION Y FINANZAS<br></b>                        <b>  DIRECCION DE TESORO MUNICIPAL<br></b>                        <b>  UNIDAD DE PRESUPUESTO<br></b>                        <b>  AREA DE ARCHIVO FINANCIERO</b>                     </td>                     <td style="width: 22%;"></td>                     <td style="width: 22%;"></td>                     <td rowspan="4" style="width: 15%; font-size:8px;">                       <img style="float:left;width:100px;height:80px;" src="' . base_url() . 'assets/qr/'.$pre_id.'.png">                     </td>                  </tr>                </table>                <div style="text-align:center;font-size:14pt; line-height:1;"><b>ACTA DE PRESTAMO</b><br>                <span style="font-size:9pt;"><b>CITE:</b>'.$pre_cite_af.'</span>                </div>';            $pdf->writeHTML($html_head, true, false, true, false, '');            $date =date("d/m/Y");   ;            $html_cabecera='                <br>                <p style="text-indent: 30px;text-align:justify;font-family:Verdana;font-style: italic;">                    En la ciudad de El Alto, <b>'.$date.'</b> en oficinas del Área de Archivo Financiero del Gobierno Autónomo                      Municipal de El Alto, en presencia de: <b>'.$pre_solicitante.'</b>  que corresponde al CITE: <b>'.$pre_cite_solicitud.'</b>                    de la <b>'.$pre_dependencia.'</b> se procede al préstamo de la siguiente documentación, que se detalla a continuación:                </p><br>';            $pdf->writeHTML($html_cabecera, true, false, true, false, '');            $documentos=$this->Prestamo_model->list_doc($pre_id);            $html = '<style>                            table {                                border-collapse: separate;                                border-spacing:  3px 3px;                                                            }                            table, th, td {                            border: 1px solid black;                            font-size: 10pt;                            text-align: center;                            padding-top: 5pt;                            padding-bottom: 5pt;                            }                      </style>                <table>                  <thead>                      <tr style="background-color:lightgrey;">                         <th style="width: 10%"><b>DTM</b></th>                         <th style="width: 13%"><b>Nº ARCHIVO</b></th>                         <th style="width: 13%"><b>Nº FOJAS</b></th>                         <th style="width: 54%"><b>DESCRIPCION</b></th>                         <th style="width: 10%"><b>GESTION</b></th>                      </tr>                  <tbody>';                    foreach ($documentos as $doc)                    {                        $detalles_doc=$this->Prestamo_model->list_archivos_decrip($doc->doc_name,$doc->doc_nro,$doc->doc_gestion);                        $detalles_foj=$this->Prestamo_model->list_archivos_fojas($doc->doc_name,$doc->doc_nro,$doc->doc_gestion);                        $html.='<tr>';                        $html.='<td>'.$doc->doc_name.'</td>';                        $html.='<td>'.$doc->doc_nro.'</td>';                        foreach ($detalles_foj as $foj)                        {                            $html.='<td>'.$foj.'</td>';                        }                        foreach ($detalles_doc as $det)                        {                            $html.='<td style="text-align:center;font-family:Verdana;font-style:normal;font-size:6pt;">'.$det.'</td>';                        }                        $html.='<td>'.$doc->doc_gestion.'</td>';                        $html.='</tr>';                    }            $pg_date = $pre_fecha_prestamo;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $pre_fecha_prestamo = date_format($date_obj, 'd/m/Y');            $pg_date = $pre_fecha_devolucion;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $pre_fecha_devolucion = date_format($date_obj, 'd/m/Y');            $row_admin=$this->Prestamo_model->row_adminHab($pre_autorizado);            $html.=                  '</tbody>                </table>                <br>                <p style="text-indent: 30px;text-align:justify;font-family:Verdana;font-style: italic;">                    La documentación en préstamo deberá ser devuelta en un plazo de <b>5 días hábiles</b>, computables a                     partir de la suscripción de la presente Acta y sea en estricta sujeción a lo establecido por el                      Art. 84 del Decreto Supremo Nº 27113 – Reglamento a la Ley Nº 234 del Procedimiento Administrativo.                </p>                    <p style="text-indent: 30px;text-align:justify;font-family:Verdana;font-style: italic;">                La negativa o vulneración a este aspecto será sancionado de acuerdo al Reglamento Interno del                 Gobierno Autónomo Municipal de El Alto.                </p><br>                                    <table style=" padding-top: 4pt;  padding-bottom: 4pt;">                          <thead>                              <tr style="background-color:lightgrey;">                                 <th width="25%"><b>FECHA DE PRESTAMO</b></th>                                 <th width="27%"><b>FECHA DE DEVOLUCION</b></th>                                 <th width="48%"><b>OBSERVACIONES</b></th>                              </tr>                           </thead>                             <tbody>                              <tr>                                <td width="25%"><img src="'.base_url().'assets/svg/calendario.svg" width="15px" heigth="9px"><span style="font-size:11pt;"> '.$pre_fecha_prestamo.'</span></td>                                <td width="27%"><img src="'.base_url().'assets/svg/calendario.svg" width="15px" heigth="9px"><span style="font-size:11pt;"> '.$pre_fecha_devolucion.'</span></td>                                <td width="48%" style="font-size:6pt;">'.$pre_observaciones.'</td>                              </tr>                          </tbody>                     </table>                     <br><br>                                          <table style="border: 0px none white;border-collapse: separate; padding-top: 80pt">                        <tr>                            <td style="text-align:center;font-family:Verdana;font-style:normal;font-size:8pt;">                                                                <b>Entregue Conforme</b><br>                                '.$data_session['usu_nombres'].' '.$data_session['usu_paterno'].' '.$data_session['usu_materno'].'<br>                                <b>'.$data_session['rol_nombre'].'</b>                            </td>                            <td style="text-align:center;font-family:Verdana;font-style:normal;font-size:8pt;">                                                                        <b>Recibi Conforme</b><br>                                    ..................................................<br>                                    ..................................................<br>                                    Cel:.................................                            </td>                            <td style="text-align:center;font-family:Verdana;font-style:normal;font-size:8pt;">                                                                        <b>Autorizado Conforme</b><br>                                    '.$row_admin->usu_nombres.' '.$row_admin->usu_paterno.' '.$row_admin->usu_materno.'<br>                                    <b>RESPONSABLE DE ARCHIVO FINANCIERO<br>Corp:</b>69960407                            </td>                         </tr>                     </table>               <p style="text-align:justify;font-family:Verdana;font-style: italic;font-size:8pt;">                <b>IMPORTANTE:</b> En caso de deterioro o perdida de la documentación, la responsabilidad recae en                 Servidor(a) Publico que solicito el préstamo, sin perjuicio de las sanciones establecidas por normativa legal vigente.                 </p>';            // output the HTML content            $pdf->writeHTML($html, true, false, true, false, '');            //Close and output PDF document            $pdf->Output('dcc_prestamo.pdf', 'I');        }        else        {            redirect("Admin_control/prestamo_index");        }        /*if ($this->Pdp_model->savePDP($data))            redirect("Admin_control/pdp_index");        else            echo "Existe los Datos del PDP que desea Registrar";*/    }    public function ver_archivo($pre_id){        $data = $this->Prestamo_model->ver_Archivo($pre_id);        echo json_encode($data);    }    public function ver_detalle_archivo(){        $doc_name = $this->input->post('doc_name');        $doc_nro = $this->input->post('doc_nro');        $doc_gestion = $this->input->post('doc_gestion');        $data = $this->Prestamo_model->ver_Detalle_Archivo($doc_name, $doc_nro, $doc_gestion);        echo json_encode($data);    }    public function finalizar_Prestamo(){        $pre_id = strip_tags(trim($this->input->post('pre_id')));        $usu_fin = strip_tags(trim($this->input->post('usu_fin')));        date_default_timezone_set('America/La_Paz');        $time = time();        $fecha_actual = date("Y-m-d", $time);        $data = array(            'pre_estado' => false,            'pre_id_rol_fin' => $usu_fin,            'pre_fecha_real_dev' => $fecha_actual        );            if ($this->Prestamo_model->finalizarPrestamo($pre_id,$data) == true)                echo "Prestamo Concluido";            else                echo "ERROR DE Finalizar Prestamo";    }    ////////HISTORIAL///////////////    public function historial_index()    {        $data_session = $this->session->all_userdata();        if (isset($data_session)) {            if ($data_session['rol_nombre'] == 'SECRETARIA' and $data_session['hab_estado'] == true) {                $data['gestion']=$this->Prestamo_model->list_gestion();                $data['admin']=$this->Prestamo_model->list_adminHab();                $data['prestamos']=$this->Prestamo_model->list_prestamos_historial();                $this->load->view('head', $data_session);                date_default_timezone_set('America/La_Paz');                $time = time();                $fecha_actual = date("Y-m-d", $time);                $pre['count']=$this->Prestamo_model->cant_Prestamos($fecha_actual);                $pre['mora']=$this->Prestamo_model->list_prestamos_mora($fecha_actual);                $this->load->view('menu_sec',$pre);                $this->load->view('HISTORIAL/historial_sec', $data);            } else {                redirect('/Login_control/close_session', 'refresh');            }        } else {            redirect('/Login_control/close_session', 'refresh');        }    }    /* Desarrollado por:        Lic. Mark Erik Copa        Ing. Nelson Erwin Aleluya        G.A.M.E.A.        2018 */}