<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Tec_control extends CI_Controller{    public function __construct()    {        parent::__construct();        $this->load->model('Login_model');        $this->load->model('User_model');        $this->load->model('Dtm_model_tec');        $this->load->model('Ci_modelo_tec');        $this->load->model('Cd_model_tec');        $this->load->model('Cdaf_model_tec');        $this->load->model('Pdp_model_tec');        $this->load->model('Pmruc_model_tec');        $this->load->helper(array('html', 'url', 'form'));        $this->load->library('session');        $this->load->library('upload');    }    //////////DTM//////////    public function index()    {        $data_session = $this->session->all_userdata();        if(isset($data_session))        {            if($data_session ['rol_nombre'] == 'TECNICO' and $data_session['hab_estado'] == true )            {                $this->load->view('head', $data_session);                $this->load->view('menu_tec');                $this->load->view('DTM/dtm_tec');            }else{                redirect('/Login_control/close_session', 'refresh');            }        }else{            redirect('/Login_control/close_session', 'refresh');        }    }    public  function list_DTM()    {        $fetch_data = $this->Dtm_model_tec->make_dataTables();        $data = array();        foreach ($fetch_data as $row)        {            $subarray = array();            $rowComplement = $this->Dtm_model_tec->list_dtmComplement($row->dtm_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>DTM</b>: <span style="background-color: #FFFF66">' . $row->dtm_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->dtm_gestion;                $pg_date = $rowComplement->dtm_fecha_ingreso;                $date_obj = date_create_from_format('Y-m-d', $pg_date);                $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->dtm_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->dtm_nro_fojas . '<br><span  data-role="hint"                data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->dtm_monto, 2, ',', '.');            $subarray[] = '<span  data-role="hint" data-hint-text="Beneficiario" data-hint-position="right"><span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' .                $row->dtm_beneficiario . '</span></span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="right"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->dtm_nro_cheque.                '<br><span ><b>Nro. Contrato:</b> ' . $rowComplement->dtm_nro_con .'</span>';            $subarray[] = '<span><b>Por:</b> ' . $row->dtm_descripcion .'</span>';            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->dtm_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->dtm_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->dtm_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->dtm_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->dtm_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->dtm_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->dtm_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->dtm_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->dtm_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->dtm_obj_gasto;            if ($row->dtm_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/DTM/'. $row->dtm_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a><br>                                <button class="button alert rounded mini drop-shadow" onclick="deletePdfDTM('. $row->dtm_id .')"><b>X</b> Elimniar PDF</button>';            }            else {                $subarray[] = '<button  class="upload_file rounded drop-shadow" onclick="uploadDTM('. $row->dtm_id .','. $rowComplement->dtm_nro .','. $rowComplement->dtm_gestion .')"><span class="mif-upload mif-4x"></span></button>';            }            $subarray[] = '<span style="display: none;">'.$row->dtm_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            'draw' => intval($_POST['draw']),            'recordsTotal' => $this->Dtm_model_tec->get_all_data(),            'recordsFiltered' => $this->Dtm_model_tec->get_filtered_data(),            'data' => $data        );        echo json_encode($output);    }    public function get_dtm($dtm_id)    {        $data = $this->Dtm_model_tec->getDTM($dtm_id);        echo json_encode($data);    }    public function upload_DTM()    {        $nFile = htmlspecialchars($_POST['nFile']);        $dtm_id = htmlspecialchars($_POST['dtm_id']);        if (!empty($_FILES['dtm_file'] )) {            if ($_FILES['dtm_file']['type'] == 'application/pdf') {                if (isset($_FILES['dtm_file'])) {                    $nombreArchivo = $nFile.".pdf";                    $destination = './assets/uploads/DTM/' . $nombreArchivo;                    move_uploaded_file($_FILES['dtm_file']['tmp_name'], $destination);                    $data = array('dtm_adjuntar' => $nombreArchivo);                    $this->Dtm_model_tec->uploadDTM($data, $dtm_id);                    echo "<b>Archivo guardado correctamente</b>";                }            }else            {                echo "<b>El formato del archivo no está permitido.</b>";            }        } else {            echo "Debe cargar un archivo PDF";        }    }    public function deletePdf_DTM()    {        $dtm_id = trim($this->input->post("dtm_id"));        $dtm_adj = trim($this->input->post("dtm_adjuntar"));        $data = array('dtm_adjuntar' => null);        if ($this->Dtm_model_tec->deletePDF_DTM($dtm_id, $data) == true) {            unlink('./assets/uploads/DTM/'.$dtm_adj);            echo "Archivo DTM Eliminado";        }        else            echo "El archivo DTM que Desea Eliminar NO EXISTE";    }    //////////CI//////////    public function ci_index()    {        $data_session = $this->session->all_userdata();        if(isset($data_session))        {            if($data_session ['rol_nombre'] == 'TECNICO' and $data_session['hab_estado'] == true )            {                $this->load->view('head', $data_session);                $this->load->view('menu_tec');                $this->load->view('CI/ci_tec');            }else{                redirect('/Login_control/close_session', 'refresh');            }        }else{            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_CI()    {        $fetch_data = $this->Ci_modelo_tec->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Ci_modelo_tec->list_ciComplement($row->ci_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>CI</b>: <span style="background-color: #FFFF66">' . $row->ci_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->ci_gestion;            $pg_date = $rowComplement->ci_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->ci_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->ci_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->ci_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->ci_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->ci_nro_cheque .                '<br><b>Nro. Contrato:</b> ' . $rowComplement->ci_nro_con . '</span>';            $subarray[] = '<b>Por:</b> ' . $row->ci_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->ci_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->ci_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->ci_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b></span>' . $row->ci_cuce . '<br><b>Obj. de Gasto: </b>' . $rowComplement->ci_obj_gasto;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->ci_sisin . '</span><br><b>Part. Pptria.: </b> ' . $rowComplement->ci_partida_pre;            if ($row->ci_adjuntar != '')                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/CI/'. $row->ci_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a><br>                                <button class="button alert rounded mini drop-shadow" onclick="deletePdfCI('. $row->ci_id .')"><b>X</b> Elimniar PDF</button>';            else                $subarray[] = '<button  class="upload_file rounded drop-shadow" onclick="uploadCI('. $row->ci_id .','. $rowComplement->ci_nro .','. $rowComplement->ci_gestion .')"><span class="mif-upload mif-4x"></span></button>';            $subarray[] = '<span style="display: none;">' . $row->ci_id . '</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Ci_modelo_tec->get_all_data(),            "recordsFiltered" => $this->Ci_modelo_tec->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_ci($ci_id)    {        $data = $this->Ci_modelo_tec->getCI($ci_id);        echo json_encode($data);    }    public function upload_CI()    {        $nFile = htmlspecialchars($_POST['nFile']);        $ci_id = htmlspecialchars($_POST['ci_id']);        if (!empty($_FILES['ci_file'] )) {            if ($_FILES['ci_file']['type'] == 'application/pdf') {                if (isset($_FILES['ci_file'])) {                    $nombreArchivo = $nFile.".pdf";                    $destination = './assets/uploads/CI/' . $nombreArchivo;                    move_uploaded_file($_FILES['ci_file']['tmp_name'], $destination);                    $data = array('ci_adjuntar' => $nombreArchivo);                    $this->Ci_modelo_tec->uploadCI($data, $ci_id);                    echo "<b>Archivo guardado correctamente</b>";                }            }else            {                echo "<b>El formato del archivo no está permitido.</b>";            }        } else {            echo "Debe cargar un archivo PDF";        }    }    public function deletePdf_CI()    {        $ci_id = trim($this->input->post("ci_id"));        $ci_adj = trim($this->input->post("ci_adjuntar"));        $data = array('ci_adjuntar' => null);        if ($this->Ci_modelo_tec->deletePDF_CI($ci_id, $data) == true) {            unlink('./assets/uploads/CI/'.$ci_adj);            echo "Archivo CI Eliminado";        }        else            echo "El archivo CI que Desea Eliminar NO EXISTE";    }    //////////CD//////////    public function cd_index()    {        $data_session = $this->session->all_userdata();        if(isset($data_session))        {            if($data_session ['rol_nombre'] == 'TECNICO' and $data_session['hab_estado'] == true )            {                $this->load->view('head', $data_session);                $this->load->view('menu_tec');                $this->load->view('CD/cd_tec');            }else{                redirect('/Login_control/close_session', 'refresh');            }        }else{            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_CD()    {        $fetch_data = $this->Cd_model_tec->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Cd_model_tec->list_cdComplement($row->cd_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>CD</b>: <span style="background-color: #FFFF66">' . $row->cd_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->cd_gestion;            $pg_date = $rowComplement->cd_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->cd_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->cd_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->cd_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"><span  data-role="hint" data-hint-text="Beneficiario" data-hint-position="right"></span></span> ' . $row->cd_beneficiario . '</span></span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->cd_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->cd_nro_con;            $subarray[] = '<b>Por:</b> ' . $row->cd_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->cd_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->cd_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->cd_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->cd_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->cd_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->cd_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->cd_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->cd_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->cd_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->cd_obj_gasto;            if ($row->cd_adjuntar != '')                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/CD/'. $row->cd_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a><br>                                <button class="button alert rounded mini drop-shadow" onclick="deletePdfCD('. $row->cd_id .')"><b>X</b> Eliminar PDF</button>';            else                $subarray[] = '<button  class="upload_file rounded drop-shadow" onclick="uploadCD('. $row->cd_id .','. $rowComplement->cd_nro .','. $rowComplement->cd_gestion .')"><span class="mif-upload mif-4x"></span></button>';            $subarray[] = '<span style="display: none;">'.$row->cd_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Cd_model_tec->get_all_data(),            "recordsFiltered" => $this->Cd_model_tec->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_cd($cd_id)    {        $data = $this->Cd_model_tec->getCD($cd_id);        echo json_encode($data);    }    public function upload_CD()    {        $nFile = htmlspecialchars($_POST['nFile']);        $cd_id = htmlspecialchars($_POST['cd_id']);        if (!empty($_FILES['cd_file'] )) {            if ($_FILES['cd_file']['type'] == 'application/pdf') {                if (isset($_FILES['cd_file'])) {                    $nombreArchivo = $nFile.".pdf";                    $destination = './assets/uploads/CD/' . $nombreArchivo;                    move_uploaded_file($_FILES['cd_file']['tmp_name'], $destination);                    $data = array('cd_adjuntar' => $nombreArchivo);                    $this->Cd_model_tec->uploadCD($data, $cd_id);                    echo "<b>Archivo guardado correctamente</b>";                }            }else            {                echo "<b>El formato del archivo no está permitido.</b>";            }        } else {            echo "Debe cargar un archivo PDF";        }    }    public function deletePdf_CD()    {        $cd_id = trim($this->input->post("cd_id"));        $cd_adj = trim($this->input->post("cd_adjuntar"));        $data = array('cd_adjuntar' => null);        if ($this->Cd_model_tec->deletePDF_CD($cd_id, $data) == true) {            unlink('./assets/uploads/CD/'.$cd_adj);            echo "Archivo CD Eliminado";        }        else            echo "El archivo CD que Desea Eliminar NO EXISTE";    }    //////////CDAF//////////    public function cdaf_index()    {        $data_session = $this->session->all_userdata();        if(isset($data_session))        {            if($data_session ['rol_nombre'] == 'TECNICO' and $data_session['hab_estado'] == true )            {                $this->load->view('head', $data_session);                $this->load->view('menu_tec');                $this->load->view('CDAF/cdaf_tec');            }else{                redirect('/Login_control/close_session', 'refresh');            }        }else{            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_CDAF()    {        $fetch_data = $this->Cdaf_model_tec->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Cdaf_model_tec->list_cdafComplement($row->cdaf_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>CDAF</b>: <span style="background-color: #FFFF66">' . $row->cdaf_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->cdaf_gestion;            $pg_date = $rowComplement->cdaf_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->cdaf_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->cdaf_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->cdaf_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->cdaf_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->cdaf_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->cdaf_nro_con;            $subarray[] = '<b>Por:</b> ' . $row->cdaf_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->cdaf_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->cdaf_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->cdaf_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->cdaf_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->cdaf_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->cdaf_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->cdaf_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->cdaf_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->cdaf_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->cdaf_obj_gasto;            if ($row->cdaf_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/CDAF/'. $row->cdaf_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a><br>                                <button class="button alert rounded mini drop-shadow" onclick="deletePdfCDAF('. $row->cdaf_id .')"><b>X</b> Elimniar PDF</button>';            }            else {                $subarray[] = '<button  class="upload_file rounded drop-shadow" onclick="uploadCDAF('. $row->cdaf_id .','. $rowComplement->cdaf_nro .','. $rowComplement->cdaf_gestion .')"><span class="mif-upload mif-4x"></span></button>';            }            $subarray[] = '<span style="display: none;">'.$row->cdaf_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Cdaf_model_tec->get_all_data(),            "recordsFiltered" => $this->Cdaf_model_tec->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_cdaf($cdaf_id)    {        $data = $this->Cdaf_model_tec->getCDAF($cdaf_id);        echo json_encode($data);    }    public function upload_CDAF()    {        $nFile = htmlspecialchars($_POST['nFile']);        $cdaf_id = htmlspecialchars($_POST['cdaf_id']);        if (!empty($_FILES['cdaf_file'] )) {            if ($_FILES['cdaf_file']['type'] == 'application/pdf') {                if (isset($_FILES['cdaf_file'])) {                    $nombreArchivo = $nFile.".pdf";                    $destination = './assets/uploads/CDAF/' . $nombreArchivo;                    move_uploaded_file($_FILES['cdaf_file']['tmp_name'], $destination);                    $data = array('cdaf_adjuntar' => $nombreArchivo);                    $this->Cdaf_model_tec->uploadCDAF($data, $cdaf_id);                    echo "<b>Archivo guardado correctamente</b>";                }            }else            {                echo "<b>El formato del archivo no está permitido.</b>";            }        } else {            echo "Debe cargar un archivo PDF";        }    }    public function deletePdf_CDAF()    {        $cdaf_id = trim($this->input->post("cdaf_id"));        $cdaf_adj = trim($this->input->post("cdaf_adjuntar"));        $data = array('cdaf_adjuntar' => null);        if ($this->Cdaf_model_tec->deletePDF_CDAF($cdaf_id, $data) == true) {            unlink('./assets/uploads/CDAF/'.$cdaf_adj);            echo "Archivo CDAF Eliminado";        }        else            echo "El archivo CDAF que Desea Eliminar NO EXISTE";    }    //////////PDP//////////    public function pdp_index()    {        $data_session = $this->session->all_userdata();        if(isset($data_session))        {            if($data_session ['rol_nombre'] == 'TECNICO' and $data_session['hab_estado'] == true )            {                $this->load->view('head', $data_session);                $this->load->view('menu_tec');                $this->load->view('PDP/pdp_tec');            }else{                redirect('/Login_control/close_session', 'refresh');            }        }else{            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_PDP()    {        $fetch_data = $this->Pdp_model_tec->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Pdp_model_tec->list_pdpComplement($row->pdp_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>PDP</b>: <span style="background-color: #FFFF66">' . $row->pdp_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->pdp_gestion;            $pg_date = $rowComplement->pdp_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->pdp_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->pdp_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->pdp_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->pdp_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->pdp_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->pdp_nro_con;            $subarray[] = '<br><b>Por:</b> ' . $row->pdp_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->pdp_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->pdp_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->pdp_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->pdp_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->pdp_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->pdp_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->pdp_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->pdp_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->pdp_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->pdp_obj_gasto;            if ($row->pdp_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/PDP/'. $row->pdp_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a><br>                                <button class="button alert rounded mini drop-shadow" onclick="deletePdfPDP('. $row->pdp_id .')"><b>X</b> Elimniar PDF</button>';            }            else {                $subarray[] = '<button  class="upload_file rounded drop-shadow" onclick="uploadPDP('. $row->pdp_id .','. $rowComplement->pdp_nro .','. $rowComplement->pdp_gestion .')"><span class="mif-upload mif-4x"></span></button>';            }            $subarray[] = '<span style="display: none;">'.$row->pdp_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Pdp_model_tec->get_all_data(),            "recordsFiltered" => $this->Pdp_model_tec->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_pdp($pdp_id)    {        $data = $this->Pdp_model_tec->getPDP($pdp_id);        echo json_encode($data);    }    public function upload_PDP()    {        $nFile = htmlspecialchars($_POST['nFile']);        $pdp_id = htmlspecialchars($_POST['pdp_id']);        if (!empty($_FILES['pdp_file'] )) {            if ($_FILES['pdp_file']['type'] == 'application/pdf') {                if (isset($_FILES['pdp_file'])) {                    $nombreArchivo = $nFile.".pdf";                    $destination = './assets/uploads/PDP/' . $nombreArchivo;                    move_uploaded_file($_FILES['pdp_file']['tmp_name'], $destination);                    $data = array('pdp_adjuntar' => $nombreArchivo);                    $this->Pdp_model_tec->uploadPDP($data, $pdp_id);                    echo "<b>Archivo guardado correctamente</b>";                }            }else            {                echo "<b>El formato del archivo no está permitido.</b>";            }        } else {            echo "Debe cargar un archivo PDF";        }    }    public function deletePdf_PDP()    {        $pdp_id = trim($this->input->post("pdp_id"));        $pdp_adj = trim($this->input->post("pdp_adjuntar"));        $data = array('pdp_adjuntar' => null);        if ($this->Pdp_model_tec->deletePDF_PDP($pdp_id, $data) == true) {            unlink('./assets/uploads/PDP/'.$pdp_adj);            echo "Archivo PDP Eliminado";        }        else            echo "El archivo PDP que Desea Eliminar NO EXISTE";    }    //////////PMRUC//////////    public function pmruc_index()    {        $data_session = $this->session->all_userdata();        if(isset($data_session))        {            if($data_session ['rol_nombre'] == 'TECNICO' and $data_session['hab_estado'] == true )            {                $this->load->view('head', $data_session);                $this->load->view('menu_tec');                $this->load->view('PMRUC/pmruc_tec');            }else{                redirect('/Login_control/close_session', 'refresh');            }        }else{            redirect('/Login_control/close_session', 'refresh');        }    }    public function list_PMRUC()    {        $fetch_data = $this->Pmruc_model_tec->make_dataTables();        $data = array();        foreach ($fetch_data as $row) {            $subarray = array();            $rowComplement = $this->Pmruc_model_tec->list_pmrucComplement($row->pmruc_id);            $subarray[] = '<span style="border-bottom:2px black solid;"><span style="font-size: 12px"><b>PMRUC</b>: <span style="background-color: #FFFF66">' . $row->pmruc_nro . '</span></span></span><br><b>Gestion:</b> ' . $rowComplement->pmruc_gestion;            $pg_date = $rowComplement->pmruc_fecha_ingreso;            $date_obj = date_create_from_format('Y-m-d', $pg_date);            $date = date_format($date_obj, 'd-m-Y');            $subarray[] = '<span style="border-bottom:2px black solid;"><b>Nro. Correlativo:</b> ' . $row->pmruc_correlativo . '</span><br><b>Nº Fojas:</b> ' . $rowComplement->pmruc_nro_fojas . '<br><span  data-role="hint"            data-hint-text="Fecha de Ingreso" data-hint-position="right"><span class="mif-calendar fg-darkBlue mif-lg"></span> ' . $date . '</span>';            $monto = number_format($rowComplement->pmruc_monto, 2, ',', '.');            $subarray[] = '<span style="border-bottom:2px black solid;"><span class="mif-user-secret fg-darkGreen mif-lg"></span> ' . $row->pmruc_beneficiario . '</span><br><span  data-role="hint" data-hint-text="Monto" data-hint-position="left"><b>Bs. </b> ' . $monto . '</span><br><b>Nº Cheque: </b> ' . $rowComplement->pmruc_nro_cheque                .'<br><b>Nro. Contrato:</b> ' . $rowComplement->pmruc_nro_con;            $subarray[] = '<br><b>Por:</b> ' . $row->pmruc_descripcion;            $subarray[] = '<ul data-role="listview" data-view-icons="icons-medium">                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="ESTANTE" data-icon="' . base_url() . 'assets/svg/estante-lleno.svg" data-caption="' . $row->pmruc_estante . '" style="border-bottom:2px black solid;"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="BALDA"                                data-icon="' . base_url() . 'assets/svg/balda.svg" data-caption="' . $rowComplement->pmruc_balda . '"></li>                            <li data-role="hint"                                data-hint-position="left"                                data-hint-text="FILA"                                data-icon="' . base_url() . 'assets/svg/fila.svg" data-caption="' . $rowComplement->pmruc_fila . '"></li>                        </ul>';            $subarray[] = '<span style="border-bottom:2px black solid;"><b>CUCE: </b>' . $row->pmruc_cuce . '</span><br><b>Cite/Nro:</b> ' . $rowComplement->pmruc_orden_cite . '<br><b>ORDEN DE </b>' . $rowComplement->pmruc_orden_tipo .                '<br><b>BD: </b> ' . $rowComplement->pmruc_bd;            $subarray[] = '<span style="border-bottom:2px black solid;"><b>SISIN: </b> ' . $row->pmruc_sisin . '</span><br><b>Part. Pptaria.: </b> ' . $rowComplement->pmruc_partida_pre . '<br><b>Objeto de gasto: </b> ' . $rowComplement->pmruc_obj_gasto;            if ($row->pmruc_adjuntar != '') {                $subarray[] = '<a class="file_upload" href="'.base_url().'assets/uploads/PMRUC/'. $row->pmruc_adjuntar.'" target="_blank"><span class="mif-file-pdf fg-red mif-5x"></span></a><br>                                <button class="button alert rounded mini drop-shadow" onclick="deletePdfPMRUC('. $row->pmruc_id .')"><b>X</b> Elimniar PDF</button>';            }            else {                $subarray[] = '<button  class="upload_file rounded drop-shadow" onclick="uploadPMRUC('. $row->pmruc_id .','. $rowComplement->pmruc_nro .','. $rowComplement->pmruc_gestion .')"><span class="mif-upload mif-4x"></span></button>';            }            $subarray[] = '<span style="display: none;">'.$row->pmruc_id .'</span><b>Ninguno</b>';            $data[] = $subarray;        }        $output = array(            "draw" => intval($_POST["draw"]),            "recordsTotal" => $this->Pmruc_model_tec->get_all_data(),            "recordsFiltered" => $this->Pmruc_model_tec->get_filtered_data(),            "data" => $data        );        echo json_encode($output);    }    public function get_pmruc($pmruc_id)    {        $data = $this->Pmruc_model_tec->getPMRUC($pmruc_id);        echo json_encode($data);    }    public function upload_PMRUC()    {        $nFile = htmlspecialchars($_POST['nFile']);        $pmruc_id = htmlspecialchars($_POST['pmruc_id']);        if (!empty($_FILES['pmruc_file'] )) {            if ($_FILES['pmruc_file']['type'] == 'application/pdf') {                if (isset($_FILES['pmruc_file'])) {                    $nombreArchivo = $nFile.".pdf";                    $destination = './assets/uploads/PMRUC/' . $nombreArchivo;                    move_uploaded_file($_FILES['pmruc_file']['tmp_name'], $destination);                    $data = array('pmruc_adjuntar' => $nombreArchivo);                    $this->Pmruc_model_tec->uploadPMRUC($data, $pmruc_id);                    echo "<b>Archivo guardado correctamente</b>";                }            }else            {                echo "<b>El formato del archivo no está permitido.</b>";            }        } else {            echo "Debe cargar un archivo PDF";        }    }    public function deletePdf_PMRUC()    {        $pmruc_id = trim($this->input->post("pmruc_id"));        $pmruc_adj = trim($this->input->post("pmruc_adjuntar"));        $data = array('pmruc_adjuntar' => null);        if ($this->Pmruc_model_tec->deletePDF_PMRUC($pmruc_id, $data) == true) {            unlink('./assets/uploads/PMRUC/'.$pmruc_adj);            echo "Archivo PMRUC Eliminado";        }        else            echo "El archivo PMRUC que Desea Eliminar NO EXISTE";    }    /* Desarrollado por:        Lic. Mark Erik Copa        Ing. Nelson Erwin Aleluya        G.A.M.E.A.        2018 */}